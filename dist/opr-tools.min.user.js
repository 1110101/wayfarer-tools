// ==UserScript==
// @name Wayfarer-Tools
// @version 1.1.0
// @author 1110101, https://gitlab.com/1110101/opr-tools/graphs/master
// @description formerly known as OPR-Tools
// @supportURL https://gitlab.com/1110101/opr-tools/issues
// @match https://wayfarer.nianticlabs.com/review
// @match https://wayfarer.nianticlabs.com/profile
// @homepageURL https://gitlab.com/1110101/opr-tools
// @grant unsafeWindow
// @grant GM_notification
// @grant GM_addStyle
// @downloadURL https://gitlab.com/1110101/opr-tools/raw/master/opr-tools.user.js
// @updateURL https://gitlab.com/1110101/opr-tools/raw/master/opr-tools.user.js
// ==/UserScript==

!function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(t){return e[t]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function t(){return e.default}:function t(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t){function n(){function e(){const e=M.document.querySelector('[ng-app="portalApp"]');M.$app=M.angular.element(e),M.$injector=M.$app.injector(),M.inject=M.$injector.invoke,M.$rootScope=M.$app.scope(),M.getService=function e(t){M.inject([t,function(e){M[t]=e}])},M.$scope=e=>M.angular.element(e).scope()}function t(){o(d),S();const e=M.document.getElementById("NewSubmissionController");if(null!==e&&null!==M.$scope(e).subCtrl){const t=M.$scope(e).subCtrl,o=t.pageData,r=M.$scope(M.document.getElementById("WhatIsItController")).whatCtrl,a=M.document.getElementById("AnswersController"),l=M.$scope(a).answerCtrl;if(""!==t.errorMessage)throw Error(41);if(void 0===o)throw Error(42);"NEW"===t.reviewType?n(l,t,r,o):"EDIT"===t.reviewType&&u(l,t,o),A(),O(t),x()}else M.location.pathname.includes("profile")&&k()}function n(e,t,o,l){function i(e){if(("deltaY"in(e=window.event||e)&&0!==e.deltaY||"wheelDeltaY"in e&&0!==e.wheelDeltaY)&&w===v.scrollLeft){e.preventDefault();const t=e.wheelDeltaY||25*-e.deltaY||-e.detail;v.scrollLeft-=t,w=v.scrollLeft}}function c(){function n(){c.forEach(e=>{e.style.setProperty("border","none")}),o<=r-2?(c[o].style.setProperty("border","1px dashed #ebbc4a"),S.blur(),k.blur()):6===o?S.focus():7===o&&k.focus()}let o=0,r=7,a=-1,i=-1,s=e.resetLowQuality,c;e.resetLowQuality=()=>{s(),a=-1,i=-1,o=0,n()},c=t.hasSupportingImageOrStatement?M.document.querySelectorAll(".col-sm-6 .btn-group, .text-center.hidden-xs:not(.ng-hide) .btn-group, .big-submit-button"):M.document.querySelectorAll(".col-sm-6 .btn-group, .col-sm-4.hidden-xs .btn-group, .big-submit-button"),addEventListener("keydown",t=>{let s=null;if(t.keyCode>=49&&t.keyCode<=55?s=t.keyCode-48:t.keyCode>=97&&t.keyCode<=103&&(s=t.keyCode-96),!M.document.querySelector("input[type=text]:focus")&&!M.document.querySelector("textarea:focus")){if(13!==t.keyCode&&32!==t.keyCode||!M.document.querySelector('a.button[href="/recon"]'))if(13!==t.keyCode&&32!==t.keyCode||!M.document.querySelector('[ng-click="answerCtrl2.confirmLowQuality()"]'))if(13!==t.keyCode&&32!==t.keyCode||!M.document.querySelector('[ng-click="answerCtrl2.confirmLowQualityOld()"]'))if(68===t.keyCode&&M.document.querySelector("#content > button"))M.document.querySelector("#content > button").click(),o=0,t.preventDefault();else if(84===t.keyCode){const e=M.document.querySelector("#descriptionDiv > .translate-title");e&&(e.click(),t.preventDefault())}else if(89===t.keyCode){const e=M.document.querySelector("#descriptionDiv > .translate-description");e&&(e.click(),t.preventDefault())}else if(13!==t.keyCode&&32!==t.keyCode||!M.document.querySelector('[ng-click="answerCtrl2.confirmDuplicate()"]'))if(13!==t.keyCode&&32!==t.keyCode||o!==r)if(27!==t.keyCode&&111!==t.keyCode||!M.document.querySelector('[ng-click="answerCtrl2.resetDuplicate()"]'))if(27!==t.keyCode&&111!==t.keyCode||!M.document.querySelector('[ng-click="answerCtrl2.resetLowQuality()"]'))if(27===t.keyCode||111===t.keyCode)o=0,t.preventDefault();else if(106===t.keyCode||220===t.keyCode)l.canSkip&&e.skipToNext();else if(72===t.keyCode)R();else if(M.document.querySelector('[ng-click="answerCtrl2.confirmLowQuality()"]')){if(null!=s){if(-1===a)try{M.document.getElementById("sub-group-"+s).click(),a=s-1,M.document.querySelectorAll("label.sub-group kbd").forEach(e=>e.classList.add("hide"))}catch(e){}else if(-1===i)try{M.document.querySelectorAll("#reject-reason ul ul")[a].children[s-1].children[0].click(),i=s-1}catch(e){}else M.document.getElementById("root-label").click(),a=-1,i=-1,M.document.querySelectorAll("label.sub-group kbd").forEach(e=>e.classList.remove("hide"));t.preventDefault()}}else if((107===t.keyCode||9===t.keyCode)&&o<r)o++,t.preventDefault();else if((109===t.keyCode||16===t.keyCode||8===t.keyCode)&&o>0)o--,t.preventDefault();else{if(null===s||o>r-2)return;if(null!==s&&t.shiftKey)try{M.document.getElementsByClassName("customPresetButton")[s-1].click(),document.getElementById("submitFF").disabled||(o=6,n())}catch(e){}else c[o].querySelectorAll("button.button-star")[s-1].click(),o++}else M.document.querySelector('[ng-click="answerCtrl2.resetLowQuality()"]').click(),o=0,t.preventDefault();else M.document.querySelector('[ng-click="answerCtrl2.resetDuplicate()"]').click(),o=0,t.preventDefault();else M.document.querySelector('[ng-click="answerCtrl.submitForm()"]').click(),t.preventDefault();else M.document.querySelector('[ng-click="answerCtrl2.confirmDuplicate()"]').click(),o=0,t.preventDefault();else M.document.querySelector('[ng-click="answerCtrl2.confirmLowQualityOld()"]').click(),o=0,t.preventDefault();else M.document.querySelector('[ng-click="answerCtrl2.confirmLowQuality()"]').click(),o=0,t.preventDefault();else M.document.location.href="/recon",t.preventDefault();n()}}),n()}let d=!1;m(l,M.document.querySelector("#map-card .card__footer"),"afterBegin");const p=new MutationObserver(e=>{for(let t of e)if(t.addedNodes.length>0&&"modal fade ng-isolate-scope"===t.addedNodes[0].className){let e=t.addedNodes[0].querySelectorAll("ul.sub-group-list");if(void 0!==e){e.forEach(e=>{let t=1;e.querySelectorAll("li > a").forEach(e=>{e.insertAdjacentHTML("afterbegin",`<kbd>${t++}</kbd> `)})});let n=1;t.addedNodes[0].querySelectorAll("label.sub-group").forEach(e=>{e.insertAdjacentHTML("beforeend",`<kbd class="pull-right ">${n++}</kbd>`)})}if(d&&null!==t.addedNodes[0].querySelector('.modal-body button[ng-click="answerCtrl3.reloadPage()"]'))return void(M.document.location.href="/review")}});p.observe(M.document.body,{childList:!0});let u=M.document.querySelector(".answer-btn-container.bottom-btns"),{submitButton:k,submitAndNext:S}=g(u,e,p);if(q.get(s.OPTIONS.COMMENT_TEMPLATES)&&f(),q.get(s.OPTIONS.PRESET_FEATURE)){const t='<div class="card" id="wfrt_custom_presets_card"><div class="card__body"><div>Presets&nbsp;<button class="btn btn-default btn-xs" id="addPreset">+</button></div>\n  <div class=\'btn-group\' id="wfrt_custom_presets"></div></div></div>\n';M.document.querySelector(".card-row-container").insertAdjacentHTML("afterbegin",t),I(),M.$injector.invoke(["$compile",e=>{let t=e('<span class="glyphicon glyphicon-info-sign darkgray" uib-tooltip-trigger="outsideclick" uib-tooltip-placement="left" tooltip-class="goldBorder" uib-tooltip="(Wayfarer-Tools) Create your own presets for stuff like churches, playgrounds or crosses\'.\nHowto: Answer every question you want included and click on the +Button.\n\nTo delete a preset shift-click it."></span>&nbsp; ')(M.$scope(document.getElementById("descriptionDiv")));M.document.getElementById("addPreset").insertAdjacentElement("beforebegin",t[0])}]),M.document.getElementById("addPreset").addEventListener("click",t=>{import(r).then(t=>{t[a].okBtn("Save").prompt("New preset name:",(n,r)=>{r.preventDefault(),"undefined"!==n&&""!==n&&(P(n,e,o),t[a].success(`✔ Created preset <i>${n}</i>`),I())},e=>{e.preventDefault()})})});let n=t=>{const n=t.target||t.srcElement;let l=n.id;if(""===l||"BUTTON"!==t.target.nodeName)return;let i=L.find(e=>e.uid===l);if(t.shiftKey)return import(r).then(e=>{e[a].log(`Deleted preset <i>${i.label}</i>`)}),M.document.getElementById(i.uid).remove(),void N(i);e.formData.quality=i.quality,e.formData.description=i.description,e.formData.cultural=i.cultural,e.formData.uniqueness=i.uniqueness,e.formData.location=i.location,e.formData.safety=i.safety,o.whatInput=i.nodeName.split(" ")[0];let s=o.getWhatAutocomplete();for(let e=0;e<s.length;e++)if(s[e].id===i.nodeId){o.setWhatAutocompleteNode(s[e]);break}o.whatInput="",t.target.blur(),M.$rootScope.$apply(),import(r).then(e=>{e[a].success(`✔ Applied <i>${i.label}</i>`)})};M.document.getElementById("wfrt_custom_presets").addEventListener("click",n,!1)}const v=M.document.getElementById("map-filmstrip");let w=v.scrollLeft;v.addEventListener("wheel",i,!1),v.addEventListener("DOMMouseScroll",i,!1);let C=t.initMap;t.initMap=()=>{C(),b(t.markers)},h(t.map2),b(t.markers),y(t.map,!1),y(t.map2,!0);let A=t.resetStreetView,_,O;t.resetStreetView=()=>{A(),h(t.map2),y(t.map2,!0)};let x=t.showDraggableMarker;if(t.showDraggableMarker=()=>{x(),M.getService("NewSubmissionDataService");let e=M.NewSubmissionDataService.getNewLocationMarker();q.get(s.OPTIONS.MAP_CIRCLE_40)&&google.maps.event.addListener(e,"dragend",function(){null==_?_=new google.maps.Circle({map:t.map2,center:e.position,radius:40,strokeColor:"#4CAF50",strokeOpacity:1,strokeWeight:2,fillOpacity:0}):_.setCenter(e.position)}),q.get(s.OPTIONS.MAP_CIRCLE_20)&&google.maps.event.addListener(e,"dragend",function(){null==O?O=new google.maps.Circle({map:t.map2,center:e.position,radius:20,strokeColor:"#4CCF50",strokeOpacity:1,strokeWeight:2,fillOpacity:0}):O.setCenter(e.position)})},(q.get(s.OPTIONS.MAP_CIRCLE_40)||q.get(s.OPTIONS.MAP_CIRCLE_20))&&document.querySelector("#street-view + small").insertAdjacentHTML("beforeBegin",`<small id="wfrt_map_legend" class="pull-left">\n                ${q.get(s.OPTIONS.MAP_CIRCLE_40)?'<span style="color:#ebbc4a">outer circle:</span> 40m':""}\n                ${q.get(s.OPTIONS.MAP_CIRCLE_20)?'<span style="color:#effc4a">inner circle:</span> 20m':""}\n            </small>`),screen.availWidth>768){let e=M.document.querySelector('div[class="btn-group"]').parentElement;if(t.hasSupportingImageOrStatement){const t=M.document.getElementById("descriptionDiv"),n=t.querySelector("div.text-center.hidden-xs");n.insertBefore(e,n.firstChild)}else{const t=M.document.querySelector('div[class~="pull-right"]');t.insertBefore(e,t.firstChild)}}const T=M.document.querySelectorAll("#map-filmstrip > ul > li > img"),$=function(){M.open(`${this.src}=s0`,"fulldupimage")};for(let e in T)T.hasOwnProperty(e)&&T[e].addEventListener("click",()=>{const e=M.document.querySelector("#content > img");null!==e&&(e.removeEventListener("click",$),e.addEventListener("click",$),e.setAttribute("style","cursor: pointer;"))});let D="en";try{D=F.split("-")[0]}catch(e){}const B=M.document.querySelector("#descriptionDiv a"),j=B.innerText.trim();let H=M.document.createElement("a"),z=M.document.createElement("span");z.className="glyphicon glyphicon-book",z.innerHTML=" ",H.appendChild(z),H.className="translate-title button btn btn-default pull-right",H.target="translate",H.style.setProperty("padding","0px 4px"),H.href=`https://translate.google.com/#auto/${D}/${encodeURIComponent(j)}`,H.id="wfrt_translate_title",B.insertAdjacentElement("afterend",H);const U=M.document.querySelector("#descriptionDiv").innerHTML.split("<br>")[3].trim();if("&lt;No description&gt;"!==U&&""!==U){H=M.document.createElement("a"),(z=M.document.createElement("span")).className="glyphicon glyphicon-book",z.innerHTML=" ",H.appendChild(z),H.className="translate-description button btn btn-default pull-right",H.target="translate",H.style.setProperty("padding","0px 4px"),H.href=`https://translate.google.com/#auto/${D}/${encodeURIComponent(U)}`,H.id="wfrt_translate_desc";const e=M.document.querySelectorAll("#descriptionDiv br")[2];e.insertAdjacentElement("afterend",H)}const V=M.document.querySelector('p[ng-click="subCtrl.showSupportingStatementModal()"]');null!=V&&""!==V.innerText&&(H=M.document.createElement("a"),(z=M.document.createElement("span")).className="glyphicon glyphicon-book",z.innerHTML=" ",H.appendChild(z),H.className="translate-supporting button btn btn-default pull-right",H.target="translate",H.style.setProperty("padding","0px 4px"),H.href=`https://translate.google.com/#auto/${D}/${encodeURIComponent(V.innerText)}`,H.id="wfrt_translate_support",V.insertAdjacentElement("beforebegin",H));try{const e=M.document.querySelector("#map-filmstrip > ul > li:nth-child(1) > img");null!==e&&setTimeout(()=>{e.click()},500)}catch(e){}E();let W=e.showLowQualityModal;e.showLowQualityModal=()=>{W(),setTimeout(()=>{let e;M.document.querySelector('textarea[ng-model="answerCtrl2.rejectComment"]').style.setProperty("max-width","100%"),M.$injector.invoke(["$compile",e=>{let t=M.document.querySelector(".modal-body button:last-child"),n=e('<button id="submitAndSkipLowQuality" class="button" ng-click="answerCtrl2.confirmLowQuality()" ng-disabled="!(answerCtrl2.readyToSubmitSpam())" disabled="disabled">\n                        <span class="glyphicon glyphicon-floppy-disk"></span>&nbsp;<span class="glyphicon glyphicon-forward"></span></button>')(M.$scope(t));t.insertAdjacentElement("beforebegin",n[0]),M.document.getElementById("submitAndSkipLowQuality").addEventListener("click",()=>{d=!0})}])},10)};let K=markDuplicatePressed;markDuplicatePressed=e=>{K(e),setTimeout(()=>{M.$injector.invoke(["$compile",e=>{let t=M.document.querySelector(".modal-body button:last-child"),n=e('<button id="submitAndSkipDuplicate" class="button" ng-click="answerCtrl2.confirmDuplicate()">\n                      <span class="glyphicon glyphicon-floppy-disk"></span>&nbsp;<span class="glyphicon glyphicon-forward"></span></button>')(M.$scope(t));t.insertAdjacentElement("beforebegin",n[0]),M.document.getElementById("submitAndSkipDuplicate").addEventListener("click",()=>{d=!0})}])},10)},q.get(s.OPTIONS.KEYBOARD_NAV)&&c(),n=()=>{}}function u(e,t,n){function o(){function e(){let e=r.querySelector('h3[ng-show="subCtrl.pageData.locationEdits.length > 1"]');e.style.setProperty("border","none"),d.forEach(e=>{e.style.setProperty("border","none")}),a&&o===l-3?(e.style.setProperty("border-left","4px dashed #ebbc4a"),e.style.setProperty("border-top","4px dashed #ebbc4a"),e.style.setProperty("border-right","4px dashed #ebbc4a"),e.style.setProperty("padding","16px"),e.style.setProperty("margin-bottom","0"),c.blur(),i.blur()):o<l-2?(d[o].style.setProperty("border-left","4px dashed #ebbc4a"),d[o].style.setProperty("padding-left","16px"),c.blur(),i.blur()):o===l-2?c.focus():o===l&&i.focus()}let o=0,a=n.locationEdits.length>1,l=(n.descriptionEdits.length>1)+(n.titleEdits.length>1)+a+2,s;s=a?t.allLocationMarkers:[];let d=M.document.querySelectorAll('div[ng-show="subCtrl.reviewType===\'EDIT\'"] > div[ng-show="subCtrl.pageData.titleEdits.length > 1"]:not(.ng-hide),div[ng-show="subCtrl.reviewType===\'EDIT\'"] > div[ng-show="subCtrl.pageData.descriptionEdits.length > 1"]:not(.ng-hide),div[ng-show="subCtrl.reviewType===\'EDIT\'"] > div[ng-show="subCtrl.pageData.locationEdits.length > 1"]:not(.ng-hide),.big-submit-button');addEventListener("keydown",t=>{let n=null;if(t.keyCode>=49&&t.keyCode<=53?n=t.keyCode-48:t.keyCode>=97&&t.keyCode<=101&&(n=t.keyCode-96),!M.document.querySelector("input[type=text]:focus")&&!M.document.querySelector("textarea:focus")){if(13!==t.keyCode&&32!==t.keyCode||!M.document.querySelector('a.button[href="/recon"]'))if(13!==t.keyCode&&32!==t.keyCode||o!==l)if(27===t.keyCode||111===t.keyCode)o=0;else if((107===t.keyCode||9===t.keyCode)&&o<l)o++,t.preventDefault();else if((109===t.keyCode||16===t.keyCode||8===t.keyCode)&&o>0)o--,t.preventDefault();else{if(null===n||o>l-2)return;a&&o===l-3&&n<=s.length?google.maps.event.trigger(angular.element(document.getElementById("NewSubmissionController")).scope().getAllLocationMarkers()[n-1],"click"):(a&&(n=1),d[o].querySelectorAll('.titleEditBox, input[type="checkbox"]')[n-1].click(),o++)}else M.document.querySelector('[ng-click="answerCtrl.submitForm()"]').click(),t.preventDefault();else M.document.location.href="/recon",t.preventDefault();e()}}),e()}let r=M.document.querySelector("div[ng-show=\"subCtrl.reviewType==='EDIT'\"]");m(n,r,"afterEnd");const a=new MutationObserver(e=>{for(let t of e)t.addedNodes.length>0&&"modal fade ng-isolate-scope"===t.addedNodes[0].className&&null!==t.addedNodes[0].querySelector(".modal-body a[href='/recon']")&&(M.document.location.href="/recon")});a.observe(M.document.body,{childList:!0});let l=moveSubmitButton(),{submitButton:i,submitAndNext:c}=g(l,e,a);if(q.get(s.OPTIONS.COMMENT_TEMPLATES)&&f(),y(t.locationEditsMap,!0),n.titleEdits.length>1||n.descriptionEdits.length>1)for(const e of r.querySelectorAll(".titleEditBox")){const t=e.innerText.trim();let n=M.document.createElement("a"),o=M.document.createElement("span");o.className="glyphicon glyphicon-book",o.innerHTML=" ",n.appendChild(o),n.className="translate-title button btn btn-default pull-right",n.target="translate",n.style.setProperty("padding","0px 4px"),n.href=`https://translate.google.com/#auto/${F.split("-")[0]}/${encodeURIComponent(t)}`,e.querySelector("p").style.setProperty("display","inline-block"),e.insertAdjacentElement("beforeEnd",n)}if(n.titleEdits.length<=1){let e=r.querySelector('div[ng-show="subCtrl.pageData.titleEdits.length <= 1"] h3');const t=e.innerText.trim();let n=M.document.createElement("a"),o=M.document.createElement("span");o.className="glyphicon glyphicon-book",o.innerHTML=" ",n.appendChild(o),n.className="translate-title button btn btn-default",n.target="translate",n.style.setProperty("padding","0px 4px"),n.style.setProperty("margin-left","14px"),n.href=`https://translate.google.com/#auto/${F.split("-")[0]}/${encodeURIComponent(t)}`,e.insertAdjacentElement("beforeend",n)}if(n.descriptionEdits.length<=1){let e=r.querySelector('div[ng-show="subCtrl.pageData.descriptionEdits.length <= 1"] p');const t=e.innerText.trim()||"";if("<No description>"!==t&&""!==t){let n=M.document.createElement("a"),o=M.document.createElement("span");o.className="glyphicon glyphicon-book",o.innerHTML=" ",n.appendChild(o),n.className="translate-title button btn btn-default",n.target="translate",n.style.setProperty("padding","0px 4px"),n.style.setProperty("margin-left","14px"),n.href=`https://translate.google.com/#auto/${F.split("-")[0]}/${encodeURIComponent(t)}`,e.insertAdjacentElement("beforeEnd",n)}}E(),(n.locationEdits.length<=1||t.locationEditsMap.getZoom()>19)&&t.locationEditsMap.setZoom(19),q.get(s.OPTIONS.KEYBOARD_NAV)&&o()}function m(e,t,n){const o=`\n<a class='btn btn-default' target='intel' href='https://intel.ingress.com/intel?ll=${e.lat},${e.lng}&z=17'>Intel</a>\n<a class='btn btn-default' target='gmaps' href='https://www.google.com/maps/place/${e.lat},${e.lng}'>GMaps</a>\n`,r=`\n<li><a target='osm' href='https://www.openstreetmap.org/?mlat=${e.lat}&mlon=${e.lng}&zoom=16'>OSM</a></li>\n<li><a target='bing' href='https://bing.com/maps/default.aspx?cp=${e.lat}~${e.lng}&lvl=16&style=a'>bing</a></li>\n<li><a target='heremaps' href='https://wego.here.com/?map=${e.lat},${e.lng},17,satellite'>HERE maps</a></li>\n<li><a targeT='zoomearth' href='https://zoom.earth/#${e.lat},${e.lng},18z,sat'>Zoom Earth</a></li>\n<li role='separator' class='divider'></li>\n<li><a target='swissgeo' href='http://map.geo.admin.ch/?swisssearch=${e.lat},${e.lng}'>CH - Swiss Geo Map</a></li>\n<li><a target='mapycz' href='https://mapy.cz/zakladni?x=${e.lng}&y=${e.lat}&z=17&base=ophoto&source=coor&id=${e.lng}%2C${e.lat}&q=${e.lng}%20${e.lat}'>CZ-mapy.cz (ortofoto)</a></li>\n<li><a target='mapycz' href='https://mapy.cz/zakladni?x=${e.lng}&y=${e.lat}&z=17&base=ophoto&m3d=1&height=180&yaw=-279.39&pitch=-40.7&source=coor&id=${e.lng}%2C${e.lat}&q=${e.lng}%20${e.lat}'>CZ-mapy.cz (orto+3D)</a></li>\n<li><a target='kompass' href='http://maps.kompass.de/#lat=${e.lat}&lon=${e.lng}&z=17'>DE - Kompass.maps</a></li>\n<li><a target='bayernatlas' href='https://geoportal.bayern.de/bayernatlas/index.html?X=${e.lat}&Y=${e.lng}&zoom=14&lang=de&bgLayer=luftbild&topic=ba&catalogNodes=122'>DE - BayernAtlas</a></li>\n<li><a target='pegel' href='http://opr.pegel.dk/?17/${e.lat}/${e.lng}'>DK - SDFE Orthophotos</a></li>\n<li><a target='kortforsyningen' href='https://skraafoto.kortforsyningen.dk/oblivisionjsoff/index.aspx?project=Denmark&lon=${e.lng}&lat=${e.lat}'>DK - Kortforsyningen Skråfoto</a></li>\n<li><a target='maanmittauslaitos' href='#'>FI - Maanmittauslaitos</a></li>\n<li><a target='paikkatietoikkuna' href='#'>FI - Paikkatietoikkuna</a></li>\n<li><a target='kakao' href='http://map.daum.net/link/map/${e.lat},${e.lng}'>KR - Kakao map</a></li>\n<li><a target='naver' href='http://map.naver.com/?menu=location&lat=${e.lat}&lng=${e.lng}&dLevel=14&title=CandidatePortalLocation'>KR - Naver map</a></li>\n<li><a target='kartverket' href='#'>NO - Kartverket</a></li>\n<li><a target='norgeibilder' href='#'>NO - Norge i Bilder</a></li>\n<li><a target='finnno' href='http://kart.finn.no/?lng=${e.lng}&lat=${e.lat}&zoom=17&mapType=normap&markers=${e.lng},${e.lat},r,'>NO - Finn Kart</a></li>\n<li><a target='toposvalbard' href='http://toposvalbard.npolar.no/?lat=${e.lat}&long=${e.lng}&zoom=17&layer=map'>NO - Polarinstituttet, Svalbard</a></li>\n<li><a target='geoportal_pl' href='#'>PL - GeoPortal</a></li>\n<li><a target='yandex' href='https://yandex.ru/maps/?ll=${e.lng},${e.lat}&z=18&mode=whatshere&whatshere%5Bpoint%5D=${e.lng},${e.lat}&whatshere%5Bzoom%5D=18'>RU - Yandex</a></li>\n<li><a target='2GIS' href='https://2gis.ru/geo/${e.lng},${e.lat}?queryState=center/${e.lng},${e.lat}/zoom/13'>RU - 2GIS</a></li>\n<li><a target='lantmateriet' href='#'>SE - Läntmateriet</a></li>\n<li><a target='hitta' href='https://www.hitta.se/kartan!~${e.lat},${e.lng},18z/tileLayer!l=1'>SE - Hitta.se</a></li>\n<li><a target='eniro' href='https://kartor.eniro.se/?c=${e.lat},${e.lng}&z=17&l=nautical'>SE - Eniro Sjökort</a></li>\n`;t.insertAdjacentHTML(n,`<div><div id="wfrt_map_button_group" class='btn-group dropup'>${o}<div class='button btn btn-default dropdown'><span class='caret'></span><ul id="wfrt_map_dropdown" class='dropdown-content dropdown-menu'>${r}</div>`),M.document.getElementById("wfrt_map_button_group").addEventListener("click",t=>{"maanmittauslaitos"==t.target.target?(t.preventDefault(),import(l).then(t=>{const n=t[i]("+proj=longlat","+proj=utm +zone=35",[e.lng,e.lat]);window.open(`https://asiointi.maanmittauslaitos.fi/karttapaikka/?lang=en&share=customMarker&n=${n[1].toFixed(3)}&e=${n[0].toFixed(3)}&title=${encodeURIComponent(e.title)}&desc=&zoom=11&layers=%5B%7B%22id%22%3A2%2C%22opacity%22%3A100%7D%5D`,"maanmittauslaitos")})):"norgeibilder"==t.target.target?(t.preventDefault(),import(l).then(t=>{const n=t[i]("+proj=longlat","+proj=utm +zone=33",[e.lng,e.lat]);window.open(`https://norgeibilder.no/?x=${Math.round(n[0])}&y=${Math.round(n[1])}&level=16&utm=33`,"norgeibilder")})):"geoportal_pl"==t.target.target?(t.preventDefault(),import(l).then(t=>{const n=t[i]("+proj=longlat","+proj=tmerc +lat_0=0 +lon_0=19 +k=0.9993 +x_0=500000 +y_0=-5300000 +ellps=GRS80 +units=m +no_defs",[e.lng,e.lat]);window.open(`http://mapy.geoportal.gov.pl/imap/?actions=acShowWgButtonPanel_kraj_ORTO&bbox=${n[0]-127},${n[1]-63},${n[0]+127},${n[1]+63}`,"geoportal_pl")})):"lantmateriet"==t.target.target?(t.preventDefault(),import(l).then(t=>{const n=t[i]("+proj=longlat","+proj=utm +zone=33",[e.lng,e.lat]);window.open(`https://kso.etjanster.lantmateriet.se/?e=${Math.round(n[0])}&n=${Math.round(n[1])}&z=13`,"lantmateriet")})):"paikkatietoikkuna"==t.target.target?(t.preventDefault(),import(l).then(t=>{const n=t[i]("+proj=longlat","+proj=utm +zone=35",[e.lng,e.lat]);window.open(`https://kartta.paikkatietoikkuna.fi/?zoomLevel=11&coord=${n[0].toFixed(3)}_${n[1].toFixed(3)}&mapLayers=801+100+default&uuid=90246d84-3958-fd8c-cb2c-2510cccca1d3&showMarker=true`,"paikkatietoikkuna")})):"kartverket"==t.target.target&&(t.preventDefault(),import(l).then(t=>{const n=t[i]("+proj=longlat","+proj=utm +zone=33",[e.lng,e.lat]);window.open(`http://norgeskart.no/#!?project=seeiendom&layers=1002,1014&zoom=17&lat=${n[1].toFixed(2)}&lon=${n[0].toFixed(2)}&sok=${e.lat},${e.lng}`,"kartverket")}))})}function g(e,t,n){let o=e.querySelector("button.button-primary"),r=o.cloneNode(!1);return o.addEventListener("click",()=>{n.disconnect()}),r.innerHTML='<span class="glyphicon glyphicon-floppy-disk"></span>&nbsp;<span class="glyphicon glyphicon-forward"></span>',r.title="Submit and go to next review",r.id="submitFF",r.addEventListener("click",()=>{t.openSubmissionCompleteModal=()=>{window.location.assign("/review")}}),M.$injector.invoke(["$compile",t=>{let n=t(r)(M.$scope(e));e.querySelector("#submitDiv button").insertAdjacentElement("beforeBegin",n[0])}]),{submitButton:o,submitAndNext:r}}function f(){const e="\n<button id='photo' class='btn btn-default textButton' data-tooltip='Indicates a low quality photo'>Photo</button>\n<button id='private' class='btn btn-default textButton' data-tooltip='Located on private residential property'>Private</button>",t="\n<li><a class='textButton' id='school' data-tooltip='Located on school property'>School</a></li>\n<li><a class='textButton' id='person' data-tooltip='Photo contains 1 or more people'>Person</a></li>\n<li><a class='textButton' id='perm' data-tooltip='Seasonal or temporary display or item'>Temporary</a></li>\n<li><a class='textButton' id='location' data-tooltip='Location wrong'>Location</a></li>\n<li><a class='textButton' id='natural' data-tooltip='Candidate is a natural feature'>Natural</a></li>\n<li><a class='textButton' id='emergencyway' data-tooltip='Obstructing emergency way'>Emergency Way</a></li>\n",n=M.document.getElementById("additional-comments-card"),o=n.querySelector("textarea");n.insertAdjacentHTML("beforeend",`<div class="card__footer">\n<span id="wfrt_comment_button_group" class='btn-group dropup pull-left'>${e}\n<span class='btn btn-default dropdown'><span class='caret'></span><ul id="wfrt_comment_button_dropdown" class='dropdown-content dropdown-menu'>${t}</ul>\n</span></span><span class="hidden-xs pull-right"><button id='clear' class='btn btn-default textButton' data-tooltip='clears the comment box'>Clear</button></span></div>\n`);const r=M.document.getElementsByClassName("textButton");for(let e in r)r.hasOwnProperty(e)&&r[e].addEventListener("click",e=>{const t=e.target||e.srcElement;let n=o.value;switch(n.length>0&&(n+=", "),t.id){case"photo":n+="Low quality photo";break;case"private":n+="Private residential property";break;case"duplicate":n+="Duplicate of previously reviewed portal candidate";break;case"school":n+="Located on primary or secondary school grounds";break;case"person":n+="Picture contains one or more people";break;case"perm":n+="Portal candidate is seasonal or temporary";break;case"location":n+="Portal candidate's location is not on object";break;case"emergencyway":n+="Portal candidate is obstructing the path of emergency vehicles";break;case"natural":n+="Portal candidate is a natural feature";break;case"clear":n=""}o.value=n,o.dispatchEvent(new Event("change")),e.target.blur()},!1)}function h(e){if(q.get(s.OPTIONS.MAP_CIRCLE_40)){const t=new google.maps.Circle({map:e,center:e.center,radius:40,strokeColor:"#ebbc4a",strokeOpacity:.8,strokeWeight:1.5,fillOpacity:0})}if(q.get(s.OPTIONS.MAP_CIRCLE_20)){const t=new google.maps.Circle({map:e,center:e.center,radius:20,strokeColor:"#eddc4a",strokeOpacity:.8,strokeWeight:1.5,fillOpacity:0})}}function b(e){for(let t=0;t<e.length;++t){const n=e[t];n.setIcon(p)}}function y(e,t){const n="google",o="kartverket",r=[{provider:"google",id:"roadmap"},{provider:"google",id:"terrain"},{provider:"google",id:"satellite"},{provider:"google",id:"hybrid"}];q.get(s.OPTIONS.NORWAY_MAP_LAYER)&&r.push({provider:"kartverket",id:"kartverket_topo",code:"topo4",label:"NO - Topo"},{provider:"kartverket",id:"kartverket_raster",code:"toporaster3",label:"NO - Raster"},{provider:"kartverket",id:"kartverket_sjo",code:"sjokartraster",label:"NO - Sjøkart"});const a="hybrid",l={scrollwheel:!0,gestureHandling:"greedy",mapTypeControl:!0,mapTypeControlOptions:{mapTypeIds:r.map(e=>e.id),style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}};let i;e.setOptions(l),r.forEach(t=>{switch(t.provider){case"kartverket":e.mapTypes.set(t.id,new google.maps.ImageMapType({layer:t.code,name:t.label,alt:t.label,maxZoom:19,tileSize:new google.maps.Size(256,256),getTileUrl:function(e,t){return`//opencache.statkart.no/gatekeeper/gk/gk.open_gmaps?layers=${this.layer}&zoom=${t}&x=${e.x}&y=${e.y}`}}))}}),i=t?s.PREFIX+s.VAR.MAP_TYPE_1:s.PREFIX+s.VAR.MAP_TYPE_2,e.addListener("maptypeid_changed",function(){M.localStorage.setItem(i,e.getMapTypeId())}),e.setMapTypeId(M.localStorage.getItem(i)||"hybrid")}function E(){try{const e=M.$scope(M.document.getElementById("WhatIsItController")).whatCtrl;setTimeout(()=>{e.showWhat=!0,M.$rootScope.$apply()},50)}catch(e){}}function k(){let e=0;q.get(s.OPTIONS.SCANNER_OFFSET_FEATURE)&&(e=parseInt(M.localStorage.getItem(s.SCANNER_OFFSET))||0);const t=M.document.querySelector("#profile-stats:not(.visible-xs)"),n=parseInt(t.children[0].children[1].innerText),o=parseInt(t.children[1].children[1].innerText),r=parseInt(t.children[2].children[1].innerText),a=o+r-e,l=$(a/n*100,1),i=$(o/n*100,1),c=$(r/n*100,1),d={100:"Bronze",750:"Silver",2500:"Gold",5000:"Platin",10000:"Black"};let p,u;for(const e in d)if(a<=e){u=e,p=d[e];break}const m=a/u*100,g=t.querySelectorAll("span.stats-right");g[0].insertAdjacentHTML("beforeend",", <span class=''>100%</span>"),g[1].insertAdjacentHTML("beforeend",`, <span class=''>${i}%</span>`),g[2].insertAdjacentHTML("beforeend",`, <span class=''>${c}%</span>`),t.querySelectorAll("h4")[2].insertAdjacentHTML("afterend",`<br>\n<h4><span class="stats-left">Processed <u>and</u> accepted analyses:</span> <span class="stats-right">${a}, <span class="ingress-gray">${l}%</span></span></h4>`),a<1e4?t.insertAdjacentHTML("beforeEnd",`\n<br><div>Next Ingress Recon badge tier: <b>${p} (${u})</b><br>\n<div class='progress'>\n<div class='progress-bar progress-bar-warning'\nrole='progressbar'\naria-valuenow='${m}'\naria-valuemin='0'\naria-valuemax='100'\nstyle='width: ${Math.round(m)}%;'\ntitle='${u-a} to go'>\n${Math.round(m)}%\n</div></div></div>\n`):t.insertAdjacentHTML("beforeEnd","<hr>"),t.insertAdjacentHTML("beforeEnd",`<div><i class="glyphicon glyphicon-share"></i> <input readonly onFocus="this.select();" style="width: 90%;" type="text"\nvalue="Reviewed: ${n} / Processed: ${o+r} (Created: ${o}/ Rejected: ${r}) / ${Math.round(l)}%"/></div>`),o<1e4&&q.get(s.OPTIONS.SCANNER_OFFSET_UI)&&(t.insertAdjacentHTML("beforeEnd",`\n<div id='scannerOffsetContainer'>\n<span style="margin-left: 5px" class="ingress-mid-blue pull-left">Scanner offset:</span>\n<input id="scannerOffset" onFocus="this.select();" type="text" name="scannerOffset" size="8" class="pull-right" value="${e}">\n</div>`),M.$injector.invoke(["$compile",e=>{let n=e('<span class="glyphicon glyphicon-info-sign ingress-gray pull-left" uib-tooltip-trigger="outsideclick" uib-tooltip-placement="left" tooltip-class="goldBorder" uib-tooltip="Use negative values, if scanner is ahead of Wayfarer"></span>')(M.$scope(t));M.document.getElementById("scannerOffsetContainer").insertAdjacentElement("afterbegin",n[0])}]),["change","keyup","cut","paste","input"].forEach(e=>{M.document.getElementById("scannerOffset").addEventListener(e,e=>{M.localStorage.setItem(s.SCANNER_OFFSET,e.target.value)})})),k=()=>{}}function S(){if(null!==M.document.getElementById("wfrt_preferences_button"))return;let e=M.document.createElement("a");e.classList.add("brand","upgrades-icon","pull-right"),e.addEventListener("click",()=>q.showPreferencesUI(M)),e.title="Wayfarer-Tools Preferences",e.setAttribute("id","wfrt_preferences_button");const t=M.document.createElement("span");t.classList.add("glyphicon","glyphicon-cog"),e.appendChild(t),M.document.querySelector(".header .inner-container:last-of-type").insertAdjacentElement("afterbegin",e)}function v(){function e(e,t){let n=M.document.createElement("label"),o=M.document.createElement("div");return o.className="checkbox",n.appendChild(e),n.appendChild(M.document.createTextNode(t)),o.appendChild(n),o}let t=M.document.createElement("input"),n=M.document.createElement("input");t.id=s.OPTIONS.REFRESH,t.type="checkbox",t.checked="true"===q.get(s.OPTIONS.REFRESH),n.id=s.OPTIONS.REFRESH_NOTI_DESKTOP,n.type="checkbox",n.checked="true"===q.get(s.OPTIONS.REFRESH_NOTI_DESKTOP);let o=M.document.createElement("div");o.className="panel panel-ingress",o.addEventListener("change",e=>{q.set(e.target.id,e.target.checked),e.target.checked?w():C()}),o.innerHTML="\n<div class='panel-heading'><span class='glyphicon glyphicon-refresh'></span> Refresh <sup>beta</sup> <a href='https://gitlab.com/1110101/opr-tools'><span class='label label-success pull-right'>Wayfarer-Tools</span></a></div>\n<div id='cbxDiv' class='panel-body bg-primary' style='background:black;'></div>",o.querySelector("#cbxDiv").insertAdjacentElement("afterbegin",e(n,"Desktop notification")),o.querySelector("#cbxDiv").insertAdjacentElement("afterbegin",e(t,"Refresh every 5-10 minutes"));let r=M.document.createElement("div");r.className="col-md-4 col-md-offset-4",r.appendChild(o);let a=M.document.createElement("div");a.className="row",a.appendChild(r),M.document.getElementById("NewSubmissionController").insertAdjacentElement("beforeend",a),!0===t.checked?w():C(),v=()=>{}}function w(){function e(){clearInterval(j),M.sessionStorage.setItem(s.FROM_REFRESH,"true"),M.document.location.reload()}function t(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}let n=6e4*t(5,10);j=setInterval(()=>{e()},n)}function C(){clearInterval(j)}function A(){if(M.sessionStorage.getItem(s.FROM_REFRESH)&&(M.sessionStorage.removeItem(s.FROM_REFRESH),M.document.hidden)){let e=!0;"true"===q.get(s.OPTIONS.REFRESH_NOTI_DESKTOP)&&GM_notification({title:"Wayfarer - New Wayspot Analysis Available",text:"by Wayfarer-Tools",image:"https://gitlab.com/uploads/-/system/project/avatar/3311015/opr-tools.png"});let t=setInterval(()=>{_(`${(e=!e)?p:"/imgpub/favicon.ico"}`)},1e3);addEventListener("visibilitychange",()=>{M.document.hidden||(_("/imgpub/favicon.ico"),clearInterval(t))})}}function _(e){let t;M.document.querySelector('link[rel="shortcut icon"]').href=e}function O(e){M.document.querySelector(".header .inner-container:last-of-type").insertAdjacentHTML("afterbegin",'<span id="countdownDisplay"></span>');let t=e.countdownDate,n=document.getElementById("countdownDisplay");n.style.setProperty("color","black");let o=setInterval(function(){let e=(new Date).getTime(),r=t-e,a=Math.floor(r%36e5/6e4),l=Math.floor(r%6e4/1e3);n.innerText=`${a}m ${l}s `,r<0?(clearInterval(o),n.innerText="EXPIRED",n.style.setProperty("color","red")):r<9e4&&n.style.setProperty("color","red")},1e3)}function x(){if(s.VERSION>(parseInt(M.localStorage.getItem(s.PREFIX+s.VERSION_CHECK))||s.VERSION-1)){M.localStorage.setItem(s.PREFIX+s.VERSION_CHECK,s.VERSION);const e=`\n        <h4><span class="glyphicon glyphicon-asterisk"></span> Wayfarer-Tools was updated:</h4>\n        <div>${c.changelog}</div>      \n      `;import(r).then(t=>{t[a].closeLogOnClick(!1).logPosition("bottom right").delay(0).log(e,e=>{e.preventDefault(),e.target.closest("div.default.show").remove()}).reset()})}}function I(){L=T(M);let e="";for(const t of L)e+=`<button class='btn btn-default customPresetButton' id='${t.uid}'>${t.label}</button>`;M.document.getElementById("wfrt_custom_presets").innerHTML=e}function T(e){let t=e.localStorage.getItem(s.PREFIX+s.VAR.CUSTOM_PRESETS);return null!=t&&""!==t?JSON.parse(t):[]}function P(e,t,n){let o={uid:[,,,,,].map(()=>Math.random().toString(36)[3]).join(""),label:e,nodeName:n.whatNode.name,nodeId:n.whatNode.id,quality:t.formData.quality,description:t.formData.description,cultural:t.formData.cultural,uniqueness:t.formData.uniqueness,location:t.formData.location,safety:t.formData.safety};L.push(o),M.localStorage.setItem(s.PREFIX+s.VAR.CUSTOM_PRESETS,JSON.stringify(L))}function N(e){L=L.filter(t=>t.uid!==e.uid),M.localStorage.setItem(s.PREFIX+s.VAR.CUSTOM_PRESETS,JSON.stringify(L))}function R(){let e="<a href='https://gitlab.com/1110101/opr-tools'><span class='label label-success'>Wayfarer-Tools</span></a> Key shortcuts<br>\n    <table class=\"table table-condensed \">\n    <thead>\n    <tr>\n      <th>Keys</th>\n      <th>Function</th>\n    </tr>\n    </thead>\n    <tbody>\n    <tr>\n      <td><kbd>Keys 1-5</kbd> / <kbd>Numpad 1-5</kbd></td>\n      <td>Valuate current selected field (the yellow highlighted one)</td>\n    </tr>\n    <tr>\n      <td><kbd>Shift</kbd> + <kbd>Keys 1-5</kbd></td>\n      <td>Apply custom preset (if exists)</td>\n    </tr>\n    <tr>\n      <td><kbd>Keys 1-7</kbd> / <kbd>Numpad 1-7</kbd></td>\n      <td>Rejection popup: Select list element</td>\n    </tr>\n    <tr>\n      <td><kbd>D</kbd></td>\n      <td>Mark current candidate as a duplicate of the opened portal in \"duplicates\"</td>\n    </tr>\n    <tr>\n      <td><kbd>T</kbd></td>\n      <td>Open title translation</td>\n    </tr>\n    <tr>\n      <td><kbd>Y</kbd></td>\n      <td>Open description translation</td>\n    </tr>\n    <tr>\n      <td><kbd>Space</kbd> / <kbd>Enter</kbd> / <kbd>Numpad Enter</kbd></td>\n      <td>Confirm dialog / Send valuation</td>\n    </tr>\n    <tr>\n      <td><kbd>Tab</kbd> / <kbd>Numpad +</kbd></td>\n      <td>Next field</td>\n    </tr>\n    <tr>\n      <td><kbd>Shift</kbd> / <kbd>Backspace</kbd> / <kbd>Numpad -</kbd></td>\n      <td>Previous field</td>\n    </tr>\n    <tr>\n      <td><kbd>Esc</kbd> / <kbd>Numpad /</kbd></td>\n      <td>First field</td>\n    </tr>\n    <tr>\n      <td><kbd>^</kbd> / <kbd>Numpad *</kbd></td>\n      <td>Skip Portal (if possible)</td>\n    </tr>\n    </tbody>\n    </table>";import(r).then(t=>{t[a].closeLogOnClick(!1).logPosition("bottom right").delay(0).log(e,e=>{e.preventDefault(),e.target.closest("div.default.show").remove()}).reset()})}function $(e,t){let n;if((t=+(t||0))%1!=0)throw new RangeError("precision must be an integer");return Math.round(e*(n=Math.pow(10,t)))/n}const M="undefined"==typeof unsafeWindow?window:unsafeWindow;let D=15,L,F=window.navigator.languages[0]||window.navigator.language||"en",q=new Preferences;const B=setInterval(()=>{if(0===D)return clearInterval(B),M.document.getElementById("NewSubmissionController").insertAdjacentHTML("afterBegin","\n<div id=\"wfrt_init_failed\" class='alert alert-danger'><strong><span class='glyphicon glyphicon-remove'></span> Wayfarer-Tools initialization failed, refresh page</strong></div>\n"),void v();if(M.angular){let n=!1;try{e()}catch(e){n=e}if(!n)try{t(),clearInterval(B)}catch(e){console.log(e),"41"===e.message&&v(),"42"!==e.message&&clearInterval(B)}}D--},500);let j}function o(e){GM_addStyle(e),o=()=>{}}
/*!
MIT License

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

*/
const r="https://glcdn.githack.com/1110101/opr-tools/raw/experimental/webpack/externals/alertify.1.0.11_module.js",a="alertify1011_module",l="https://glcdn.githack.com/1110101/opr-tools/raw/experimental/webpack/externals/proj4.2.5.0_module.js",i="proj4250_module",s={VERSION:20004,PREFERENCES:"wfrt_prefs",OPTIONS:{KEYBOARD_NAV:"keyboard_nav",NORWAY_MAP_LAYER:"norway_map_layer",PRESET_FEATURE:"preset_feature",SCANNER_OFFSET_FEATURE:"scanner_offset_feature",SCANNER_OFFSET_UI:"scanner_offset_ui",COMMENT_TEMPLATES:"comment_templates",MAP_CIRCLE_20:"map_circle_20",MAP_CIRCLE_40:"map_circle_40",REFRESH:"refresh",REFRESH_NOTI_DESKTOP:"refresh_noti_desktop"},PREFIX:"wfrt_",VAR_PREFIX:"wfrt_var",OPRT:"oprt_",OPRT_VAR_PREFIX:"oprt_var",OPRT_PREFERENCES:"oprt_prefs",VAR:{SCANNER_OFFSET:"scanner_offset",MAP_TYPE_1:"map_type_1",MAP_TYPE_2:"map_type_2",CUSTOM_PRESETS:"custom_presets"},VERSION_CHECK:"version_check",FROM_REFRESH:"from_refresh"};class Preferences{constructor(){this.options={},this.defaults={[s.OPTIONS.KEYBOARD_NAV]:!0,[s.OPTIONS.NORWAY_MAP_LAYER]:!1,[s.OPTIONS.PRESET_FEATURE]:!0,[s.OPTIONS.SCANNER_OFFSET_FEATURE]:!1,[s.OPTIONS.SCANNER_OFFSET_UI]:!1,[s.OPTIONS.COMMENT_TEMPLATES]:!0,[s.OPTIONS.REFRESH]:!0,[s.OPTIONS.REFRESH_NOTI_DESKTOP]:!0,[s.OPTIONS.MAP_CIRCLE_20]:!1,[s.OPTIONS.MAP_CIRCLE_40]:!0},this.loadOptions()}showPreferencesUI(e){let t=new InOut(this),n=e.document.querySelector("#content-container"),o=e.document.querySelector("#wfrt_sidepanel_container");if(null!==o)o.classList.toggle("hide");else{n.insertAdjacentHTML("afterbegin",`\n<section id="wfrt_sidepanel_container" style="\n    background: black;\n    border-left: 2px gold inset;\n    border-top: 2px gold inset;\n    border-bottom: 2px gold inset;\n    color: white;\n    position: absolute;\n    right: 0;\n    height: 90%;\n    padding: 0 20px;\n    z-index: 10;\n    width: 400px;    \n    ">\n  <div class="row">\n    <div class="col-lg-12">\n      <h4 class="gold">Wayfarer-Tools Preferences</h4>\n    </div>\n    <div class="col-lg-12">\n      <div class="btn-group" role="group">\n        <button id="import_all" class="btn btn-success">Import</button>\n        <button id="export_all" class="btn btn-success">Export</button>\n      </div>\n    </div>\n  </div>\n  <div id="wfrt_options"></div>\n  <a id="wfrt_reload" class="btn btn-warning hide"><span class="glyphicon glyphicon-refresh"></span>\n Reload to apply changes</a>\n \n <div style="position: absolute; bottom: 0; left: 0; margin:20px;"><a href="https://t.me/oprtools">${u} Wayfarer-Tools Telegram Channel</a></div> \n</section>`);let o=e.document.getElementById("wfrt_options"),l=e.document.getElementById("wfrt_reload");for(let t in this.options){if(void 0===c.options[t]){this.remove(t);continue}const n=e.document.createElement("div");n.classList.add("checkbox");const r=e.document.createElement("label"),a=e.document.createElement("input");a.type="checkbox",a.name=t,a.checked=this.options[t],n.appendChild(r),r.appendChild(a),r.appendChild(e.document.createTextNode(c.options[t])),o.insertAdjacentElement("beforeEnd",n)}o.addEventListener("change",e=>{this.set(e.target.name,e.target.checked),l.classList.remove("hide")}),l.addEventListener("click",()=>{window.location.reload()}),e.document.getElementById("import_all").addEventListener("click",()=>{import(r).then(e=>{e[a].okBtn("Import").prompt("Paste here:",(n,o)=>{o.preventDefault(),"undefined"!==n&&""!==n&&(t.importFromString(n),e[a].success("✔ Imported preferences"))},e=>{e.preventDefault()})})}),e.document.getElementById("export_all").addEventListener("click",()=>{import(r).then(e=>{void 0!==navigator.clipboard?navigator.clipboard.writeText(t.exportAll()).then(()=>{e[a].success("✔ Exported preferences to your clipboard!")},()=>{e[a].alert(t.exportAll())}):e[a].alert(t.exportAll())})})}}loadOptions(){Object.assign(this.options,this.defaults,JSON.parse(localStorage.getItem(s.PREFERENCES)))}set(e,t){this.options[e]=t,localStorage.setItem(s.PREFERENCES,JSON.stringify(this.options))}get(e){return this.options[e]}remove(e){delete this.options[e],localStorage.setItem(s.PREFERENCES,JSON.stringify(this.options))}exportPrefs(){return JSON.stringify(this.options)}importPrefs(e){try{this.options=JSON.parse(e),localStorage.setItem(s.PREFERENCES,JSON.stringify(this.options))}catch(e){throw Error("Could not import preferences!")}}}class InOut{constructor(e){this.preferences=e}static exportVars(){let e={};for(const t in s.VAR)e[s.VAR[t]]=localStorage.getItem(s.PREFIX+s.VAR[t]);return e}static importVars(e){for(const t in e)localStorage.setItem(s.PREFIX+t,e[t])}importFromString(e){try{let t=JSON.parse(e);t.hasOwnProperty(s.PREFERENCES)&&this.preferences.importPrefs(t[s.PREFERENCES]),t.hasOwnProperty(s.VAR_PREFIX)&&InOut.importVars(t[s.VAR_PREFIX]),t.hasOwnProperty(s.OPRT_PREFERENCES)&&this.preferences.importPrefs(t[s.OPRT_PREFERENCES]),t.hasOwnProperty(s.OPRT_VAR_PREFIX)&&InOut.importVars(t[s.OPRT_VAR_PREFIX])}catch(e){throw Error("Import failed")}}exportAll(){return JSON.stringify(Object.assign({},{[s.PREFERENCES]:this.preferences.exportPrefs()},{[s.VAR_PREFIX]:InOut.exportVars()}))}}setTimeout(()=>{n()},250);const c={options:{[s.OPTIONS.COMMENT_TEMPLATES]:"Comment templates",[s.OPTIONS.KEYBOARD_NAV]:"Keyboard navigation",[s.OPTIONS.NORWAY_MAP_LAYER]:"Norwegian map layer",[s.OPTIONS.PRESET_FEATURE]:"Rating presets",[s.OPTIONS.REFRESH]:"Periodically refresh wayfarer if no analysis is available",[s.OPTIONS.REFRESH_NOTI_DESKTOP]:"↳ With desktop notification",[s.OPTIONS.SCANNER_OFFSET_FEATURE]:"Scanner offset",[s.OPTIONS.SCANNER_OFFSET_UI]:"↳ Display offset input field",[s.OPTIONS.MAP_CIRCLE_20]:"Show 20 meter circle around candidate location (minimum portal distance)",[s.OPTIONS.MAP_CIRCLE_40]:"Show 40 meter circle around candidate location (capture range)"},changelog:"\nVersion 2.0.0\n<br>* Initial Wayfarer-Tools release\n"},d='\n.dropdown {\nposition: relative;\ndisplay: inline-block;\n}\n\n.dropdown-content {\ndisplay: none;\nposition: absolute;\nz-index: 1;\nmargin: 0;\n}\n\n.dropdown:hover .dropdown-content {\ndisplay: block;\n}\n\n.dropdown-menu > li > a:focus, .dropdown-menu > li > a:hover {\nbackground-color: unset;\n}\n\n.dropdown .dropdown-menu {\nleft: 0px;\nright: unset;\nwidth: unset;\n}\n\n.modal-sm {\nwidth: 350px !important;\n}\n\n.panel-ingress {\nbackground-color: #004746;\nborder: 1px solid #0ff;\nborder-radius: 1px;\nbox-shadow: inset 0 0 6px rgba(255, 255, 255, 1);\ncolor: #0ff;\n}\n\n[data-tooltip] {\nposition: relative;\ncursor: pointer;\n}\n\n[data-tooltip]:before,\n[data-tooltip]:after {\nvisibility: hidden;\n-ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";\nfilter: progid:DXImageTransform.Microsoft.Alpha(Opacity=0);\nopacity: 0;\npointer-events: none;\n}\n\n[data-tooltip]:before {\nposition: absolute;\ntop: 150%;\nleft: 50%;\nmargin-bottom: 5px;\nmargin-left: -80px;\npadding: 7px;\nwidth: relative;\n-webkit-border-radius: 3px;\n-moz-border-radius: 3px;\nborder-radius: 3px;\nbackground-color: #000;\nbackground-color: hsla(0, 0%, 20%, 0.9);\ncolor: #fff;\ncontent: attr(data-tooltip);\ntext-align: center;\nfont-size: 14px;\nline-height: 1.2;\nz-index: 100;\n}\n\n[data-tooltip]:after {\nposition: absolute;\ntop: 132%;\nleft: relative;\nwidth: 0;\nborder-bottom: 5px solid #000;\nborder-bottom: 5px solid hsla(0, 0%, 20%, 0.9);\nborder-right: 5px solid transparent;\nborder-left: 5px solid transparent;\ncontent: " ";\nfont-size: 0;\nline-height: 0;\n}\n\n[data-tooltip]:hover:before,\n[data-tooltip]:hover:after {\nvisibility: visible;\n-ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=100)";\nfilter: progid:DXImageTransform.Microsoft.Alpha(Opacity=100);\nopacity: 1;\n}\n\n.titleEditBox:hover {\nbox-shadow: inset 0 0 20px #ebbc4a;\n}\n\n.titleEditBox:active {\nbox-shadow: inset 0 0 15px 2px white;\n}\n\n.group-list li label:hover, ul.sub-group-list a:hover, #root-label:hover {\nbox-shadow: inset 0 0 5px #000000 !important;\n}\n\n.group-list li label:active, ul.sub-group-list a:active, #root-label:active {\nbox-shadow: inset 0 0 10px 2px #000000 !important;\n}\n\n.modal-body .button:focus, .modal-body textarea:focus {\noutline: 2px dashed #ebbc4a;\n}\n\n.modal-body .button:hover, .gm-style-iw button.button:hover {\nfilter: brightness(150%);\n}\n\n.alertify-logs {\nz-index: 100;\n}\n\n.alertify .dialog .msg {\ncolor: black;\n}\n\n.alertify-logs > .default {\nbackground-image: url(/img/ingress-background-dark.png) !important;\n}\n\n.btn-xs {\nmargin-left: 8px;\npadding: 0px 7px 1px !important;\nbox-shadow: inset 0 0 4px rgba(255, 255, 255, 1);\n-webkit-box-shadow: inset 0 0 4px rgba(255, 255, 255, 1);\n-moz-box-shadow: inset 0 0 4px rgba(255, 255, 255, 1);\n}\n\nkbd {\ndisplay: inline-block;\npadding: 3px 5px;\nfont: 11px SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;\nline-height: 10px;\ncolor: #444d56;\nvertical-align: middle;\nbackground-color: #fafbfc;\nborder: 1px solid #d1d5da;\nborder-bottom-color: #c6cbd1;\nborder-radius: 3px;\nbox-shadow: inset 0 -1px 0 #c6cbd1;\n}\n\n.dropdown-menu {\nmargin: 0 !important;\n}\n\n.opr-yellow {\ncolor: #F3EADA;\n}\n\n#submitAndSkipLowQuality, #submitAndSkipDuplicate {\nmargin-left: 32px;\nmargin-right: 32px;\n}\n\n#profile-stats > div {\nwidth: 60%;\n}\n#scannerOffsetContainer {\nmargin-top: 16px;\n}\n\n#wfrt_preferences_button {\n cursor: pointer;\n margin-right: 20px;\n margin-left: 20px;\n color: rgb(157,157,157);\n}\n#wfrt_custom_presets_card {\n    width: 100%;\n    height: auto;\n    min-height: unset;\n    margin-left: 15px;\n}\n#submitFF {\nmargin-right: 16px;\n}\n\n@media (min-width: 768px) {\ndiv.modal-custom1 {\nwidth: 500px;\nmax-width: unset !important;\n}\n}\n',p="data:image/png;base64,\niVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACx\njwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAu\nOWwzfk4AAADlSURBVDhPY/j//z8CTw3U/V8lcvx/MfPX/2Xcd//XyWwDYxAbJAaS63c2Q9aD0Nyg\nUPS/hPXt/3bD5f93LI7DwFvnJILlSlg//K+XrUc1AKS5jOvx/wU55Vg1I2OQmlKOpzBDIM4G2UyM\nZhgGqQW5BOgdBrC/cDkbHwbpAeplAAcONgWEMChMgHoZwCGMTQExGKiXARxN2CSJwUC9VDCAYi9Q\nHIhVQicpi0ZQ2gYlCrITEigpg5IlqUm5VrILkRdghoBMxeUd5MwE1YxqAAiDvAMKE1DAgmIHFMUg\nDGKDxDCy838GAPWFoAEBs2EvAAAAAElFTkSuQmCC",u='\n<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240" style="\n    width: 16px;\n    height: 16px;\n">\n<defs>\n  <linearGradient id="b" x1="0.6667" y1="0.1667" x2="0.4167" y2="0.75">\n    <stop stop-color="#37aee2" offset="0"></stop>\n    <stop stop-color="#1e96c8" offset="1"></stop>\n  </linearGradient>\n  <linearGradient id="w" x1="0.6597" y1="0.4369" x2="0.8512" y2="0.8024">\n    <stop stop-color="#eff7fc" offset="0"></stop>\n    <stop stop-color="#fff" offset="1"></stop>\n  </linearGradient>\n</defs>\n<circle cx="120" cy="120" r="120" fill="url(#b)"></circle>\n<path fill="#c8daea" d="m98 175c-3.8876 0-3.227-1.4679-4.5678-5.1695L82\n132.2059 170 80"></path>\n<path fill="#a9c9dd" d="m98 175c3 0 4.3255-1.372\n6-3l16-15.558-19.958-12.035"></path>\n<path fill="url(#w)" d="m100.04 144.41 48.36 35.729c5.5185 3.0449 9.5014\n1.4684\n10.876-5.1235l19.685-92.763c2.0154-8.0802-3.0801-11.745-8.3594-9.3482l-115.59\n 44.571c-7.8901 3.1647-7.8441 7.5666-1.4382 9.528l29.663\n  9.2583 68.673-43.325c3.2419-1.9659 6.2173-0.90899 3.7752 1.2584"></path>\n</svg>'}]);